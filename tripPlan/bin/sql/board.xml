<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="board">
<select id="list" resultType="board.model.BoardDTO">

   select * from tp_mainboard order by b_id desc
<!-- 검색어로 검색 -->
</select>
<select id="mainSearch" resultType="board.model.BoardDTO" parameterType="String">
   
   select b_id, b_title,b_mainphoto,b_identified,b_maincontents ,instr(b_title,#{value}),instr(b_maincontents,#{value})from tp_mainboard where instr(b_title,#{value})>=1 or instr(b_maincontents,#{value})>=1

</select>
<select id="boardSearch" resultType="board.model.BoardDTO" parameterType="map">

   select b_title,b_mainphoto,b_identified,b_id,instr(b_title,#{search1},1)from tp_mainboard where b_identified=#{option} and instr(b_title,#{search1})>=1
</select>


<select id="zzz" resultType="board.model.SubBoardDTO" parameterType="Integer">
	
	select * from tp_subboard where b_id= #{value}
</select>

<!-- MainBoard Query -->
   
   <select id="mainBoardAll" resultType="board.model.BoardDTO" parameterType="integer">
      select * from tp_mainboard where b_identified = #{value}
   </select>
   <select id="mainBoard" parameterType="integer" resultType="board.model.BoardDTO">
      select * from tp_mainboard where = #{value}
   </select>
   <insert id="insertMainBoard" parameterType="board.model.BoardDTO">
      insert into tp_mainboard values(mb_seq.nextval,#{b_title},#{b_maincontents},#{b_mainphoto, jdbcType=VARCHAR},#{b_registertime},0,#{b_startdate, jdbcType=VARCHAR},#{b_enddate, jdbcType=VARCHAR},#{b_activity},#{b_identified},#{m_email})
      <selectKey keyProperty="b_id" resultType="Integer" order="AFTER">
           SELECT mb_seq.currval FROM dual
       </selectKey>
   </insert>
   <update id="updateMainBoard" parameterType="board.model.BoardDTO">
      update tp_mainboard set b_title=#{b_title}, b_maincontents=#{b_maincontents}, b_mainphoto=#{b_mainphoto}, b_startdate=#{b_startdate}, b_enddate=#{b_enddate}, b_activity=#{b_activity}
   </update>
   <delete id="deleteMainBoard" parameterType="integer">
      delete from tp_mainboard where d_id = #{value}
   </delete>
   
   <!-- SubBoard Query -->
   
   <select id="subBoardAll" parameterType="integer" resultType="board.model.SubBoardDTO">
      select * from tp_subboard where = #{value} order by sb_procedure ASC
   </select>
   <insert id="insertSubBoard" parameterType="board.model.SubBoardDTO">
      insert into tp_subboard values(sb_seq.nextval,#{sb_destination, jdbcType=VARCHAR},#{sb_subtitle},#{sb_subcontent},#{sb_tcharge},#{sb_fcharge},#{sb_rcharge},#{sb_tripdate},#{sb_photo1, jdbcType=VARCHAR},#{sb_photo2, jdbcType=VARCHAR},#{sb_photo3, jdbcType=VARCHAR},#{sb_photo4, jdbcType=VARCHAR},#{sb_photo5, jdbcType=VARCHAR},#{sb_lat, jdbcType=VARCHAR},#{sb_lon, jdbcType=VARCHAR},#{sb_procedure},#{b_id})
   </insert>
   <update id="updateSubBoard" parameterType="board.model.SubBoardDTO">
      update tp_subboard set sb_destination=#{sb_destination}, sb_subtitle=#{sb_subtitle}, sb_subcontent=#{sb_subcontent}, sb_tcharge=#{sb_tcharge}, sb_fcharge=#{sb_fcharge}, sb_rcharge=#{sb_rcharge}, sb_tripdate=#{sb_tripdate}, sb_photo1=#{sb_photo1}, sb_photo2=#{sb_photo2}, sb_photo3=#{sb_photo3}, sb_photo4=#{sb_photo4}, sb_photo5=#{sb_photo5}, sb_lat=#{sb_lat}, sb_lon=#{sb_lon} 
   </update>
   
   <!-- fileupload Query -->
   <insert id="fileUpload" parameterType="board.model.FileDTO">
      insert into tp_file values(fi_seq.nextval,#{fi_name},#{fi_oname},#{fi_size},#{fi_path})
      <selectKey keyProperty="fi_id" resultType="Integer" order="AFTER">
           SELECT fi_seq.currval FROM dual
       </selectKey>
   </insert>
   
   <!-- pathContents Search -->
   <select id="selectBoardContents" parameterType="integer" resultType="board.model.TotalBoardDTO">
   	select * from TP_MAINBOARD inner join tp_subboard on tp_mainboard.b_id = tp_subboard.b_id where tp_mainboard.b_id=#{value} order by tp_subboard.SB_PROCEDURE asc
   </select>
   
   <!-- reply Query -->
   <select id="selectReply" parameterType="integer" resultType="board.model.ReplyDTO">
   		select * from tp_reply where b_id = #{value}
   </select>
   <insert id="insertReply" parameterType="board.model.ReplyDTO">
   		insert into tp_reply value(re_seq.nextval, #{re_contents}, #{re_registdate}, #{b_id}, #{m_email})
   </insert>
   <delete id="deleteReply" parameterType="integer">
    	delete from tp_reply where re_id=${value}
   </delete>
</mapper>